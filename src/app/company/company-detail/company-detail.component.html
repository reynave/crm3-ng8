<ngx-loading [show]="loading"></ngx-loading> 

<div class="container-fluid">

  <div class="row no-gutters">
    <div class="col-8">

      <div class="container border shadow-sm bg-white">

        <div class="row ">
          <div class="col-6">
            <small> You are here : <a [routerLink]="[ '/company' ]">Company</a> / <a [routerLink]="[ '/company/',id ]">
                {{items.name}}</a> </small>
          </div>
        </div>

        <div class="row container-header">

          <div class="col-6 ">
            <h5>COMPANY</h5>
          </div>

          <div class="col-6 text-right">


            <button type="button" class="btn btn-outline-primary  btn-sm  mr-1" [routerLink]="[ '/company/edit/',id ]">
              <i class="fas fa-edit"></i> Edit </button>

            <button type="button" class="btn btn-danger btn-sm  mr-1" (click)="fn_delete();"> <i
                class="fas fa-trash-alt"></i>
              Delete </button>

            <button type="button" class="btn btn-outline-secondary  btn-sm" [routerLink]="[ '/company' ]" title="back">
              <i class="fas fa-times"></i> </button>
          </div>

        </div>
        <h5 class="my-3">Information</h5>
        <div class="row mb-3">

          <div class="col-6">
            <strong>Company </strong>
            <table class="table table-list">
              <tbody>
                <tr>
                  <td width="30%"><label>Company</label></td>
                  <td> {{items.name}} </td>
                </tr>
                <tr>
                  <td><label>Website</label></td>
                  <td><a href="{{items.website}}" target="_blank"> {{items.website}} </a></td>
                </tr>

                <tr>
                  <td><label>Email</label></td>
                  <td> {{items.email}}</td>
                </tr>

                <tr>
                  <td><label>Phone</label></td>
                  <td> {{items.phone}}</td>
                </tr>

                <tr>
                  <td><label>Fax</label></td>
                  <td> {{items.fax}}</td>
                </tr>

                <tr>
                  <td><label>Industry</label></td>
                  <td> {{items.industry}} </td>
                </tr>
                <tr>
                  <td><label>Address</label></td>
                  <td> {{items.address}}</td>
                </tr>

                <tr [hidden]="items.branches < 1">
                  <td><label>Total Branches</label></td>
                  <td> {{items.branches}}</td>
                </tr>
              </tbody>


            </table>




          </div>

          <div class="col-6">
            <strong>Input Information</strong>
            <table class="table table-list">

              <tbody>

                <tr>
                  <td><label>Created Date</label></td>
                  <td> {{items.input_date | date:'d MMM y  hh:mm a'}}, <small> by {{items.input_by}}</small> </td>
                </tr>
                <tr [hidden]="items.update_by == false">
                  <td><label>Update Date</label></td>
                  <td> {{items.update_date | date:'d MMM y  hh:mm a'}}, <small> by {{items.update_by}} </small> </td>
                </tr>
                <tr>
                  <td><label>ID Companay</label></td>
                  <td><span class="text-monospace">{{items.id}}</span></td>
                </tr>
              </tbody>


            </table>



          </div>
        </div>



        <div class="py-2">
          <strong>Opportunity </strong>
        </div>
        <div class=" bg-light  border border-top-brown rounded p-1 mb-4">
          <div class=" mb-4">

            <table class="table table-hover border bg-white border-top border-bottom pointer">
              <thead class="thead-light">
                <tr>
                  <th width="50">No</th>
                  <th scope="col">Opportunity Name</th>
                  <th scope="col">Stage</th>
                  <th scope="col">Progress</th>
                  <th scope="col" colspan="2" class="text-right">Amount</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let x of myOpportunity; let i = index">
                  <td> {{i +1}}</td>
                  <td> <a [routerLink]="[ '/opportunity/',x.id ]"> {{x.name}} </a>
                    <div>
                      <small>Created : {{x.input_date | date}} {{x.input_by}}</small>
                    </div>
                  </td>
                  <td> {{x.stage}} </td>
                  <td> {{x.progress}}</td>
                  <td width="50"> {{x.currency}} </td>
                  <td class="text-right"> {{x.amount | number:''}} </td>

                </tr>


              </tbody>
              <tfoot>
                <tr>
                  <td></td>
                  <td colspan="7"> 
                    
                    <button type="button" class="btn btn-sm btn-primary" [routerLink]="[ '/opportunity/new/',items.id ,'0'  ]" > <i class="fas fa-plus"></i> New
                      Opportunity</button> </td>
                </tr>
              </tfoot>
            </table>

          </div>
        </div>


        <div class="py-2">
          <strong>Branches </strong>
        </div>
        <div class=" bg-light  border border-top-gray rounded p-1 mb-4">
          <iframe height="300" width="100%" frameborder="0" style="border:0" src="https://www.google.com/maps/embed/v1/place?key=AIzaSyDU5LvSHY5Dz66sGw-eJ9LwzaGGSoEKJVs
                &q=-6.2072013,106.9495600" allowfullscreen>
          </iframe>
          <div class="max-height mb-4">


            <table class="table table-hover border bg-white border-top border-bottom pointer">
              <thead class="thead-light">
                <tr>
                  <th width="50">No</th>
                  <th scope="col">ID</th>
                  <th scope="col">Branch Name</th>
                  <th scope="col" width="300">Address</th>
                  <th scope="col">Phone</th>

                  <th scope="col">Email</th>
                  <th scope="col">Status</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let x of myBranch; let i = index">
                  <td>{{ i + 1}}</td>
                  <td> <a [routerLink]="[ '/branch/',x.id ]">{{x.id}}</a></td>
                  <td> {{x.name}} </td>
                  <td> {{x.address}} </td>
                  <td> {{x.phone}}</td>
                  <td> {{x.email}} </td>
                  <td> {{x.status}} </td>
                </tr>


              </tbody>
              <tfoot>
                <tr>
                  <td></td>
                  <td colspan="6"> <button type="button" class="btn btn-classic btn-sm" (click)="open(branch);"> <i
                        class="fas fa-plus"></i> New Branch</button> </td>
                </tr>
              </tfoot>
            </table>


          </div>
        </div>




        <div class="py-2">
          <strong>Contact </strong>
        </div>
        <div class=" bg-light  border border-top-blue rounded p-1 mb-4">
          <div class="max-height mb-4">

            <table class="table table-hover border bg-white border-top border-bottom pointer">
              <thead class="thead-light">
                <tr>
                  <th width="50">No</th>
                  <th scope="col">Name</th>
                  <th scope="col">Email</th>
                  <th scope="col">Phone</th>
                  <th scope="col">Mobile</th>
                  <th scope="col">Own By</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let x of myContact ; let i = index">
                  <td>{{ i + 1}}</td>
                  <td> <a [routerLink]="[ '/contact/1' ]">{{x.name}}</a></td>
                  <td> {{x.email}}</td>
                  <td> {{x.phone}} </td>

                  <td> {{x.mobile}} </td>
                  <td> {{x.user}} </td>
                </tr>
                <tr [hidden]="!myContact">
                  <td colspan="6" class="text-center">No data</td>
                </tr>

              </tbody>
              <tfoot>
                <tr>
                  <td></td>
                  <td colspan="5"> <button type="button" class="btn btn-classic btn-sm" (click)="open(contact)"> <i
                        class="fas fa-plus"></i> New Contact</button> </td>
                </tr>
              </tfoot>
            </table>

          </div>
        </div>


        <br>

      </div>

    </div>
    <div class="col-4">
      <div class="position-fixed">
        <app-widget-activity></app-widget-activity>
      </div>

    </div>
  </div>




  <ng-template #contact let-modal>
    <div class="modal-header">
      <strong class="modal-title" id="modal-basic-title">New Contact</strong>
      <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body bg-light">

      <form (ngSubmit)="onSubmitContact()" #myForm="ngForm">
        <div class="row">

          <div class="col-6">

            <div class="form-group row no-gutters">
              <label for="h1" class="col-4 col-form-label"> First Name </label>
              <div class="col-2">
                <select class="form-control border" id="h14" [(ngModel)]="modelContact.id_title" name="id_title">
                  <option value="0"> - Select - </option>
                  <option [ngValue]="x.id" *ngFor="let x of selected.title">{{x.name}}</option>
                </select>
              </div>
              <div class="col-6">
                <input type="text" class="form-control border" id="h1" required [(ngModel)]="modelContact.first_name"
                  name="first_name" #first_name="ngModel">

                <small [hidden]="first_name.valid || first_name.pristine" class="text-danger"> First name is
                  required</small>
              </div>
            </div>

            <div class="form-group row no-gutters">
              <label for="h2" class="col-sm-4 col-form-label"> Last Name</label>
              <div class="col-sm-8">
                <input type="text" class="form-control border" id="h2" [(ngModel)]="modelContact.last_name"
                  name="last_name">
              </div>
            </div>

            <div class="form-group row no-gutters">
              <label for="h3" class="col-sm-4 col-form-label">Email</label>
              <div class="col-sm-8">
                <input type="email" class="form-control border" id="h3" [(ngModel)]="modelContact.email" name="email">
              </div>
            </div>

            <div class="form-group row no-gutters">
              <label for="h110" class="col-sm-4 col-form-label">Mobile</label>
              <div class="col-sm-8">
                <input type="text" class="form-control border" id="h110" [(ngModel)]="modelContact.mobile"
                  name="mobile">
              </div>
            </div>

            <div class="form-group row no-gutters">
              <label for="h4" class="col-sm-4 col-form-label">Phone</label>
              <div class="col-sm-8">
                <input type="text" class="form-control border" id="h4" [(ngModel)]="modelContact.phone" name="phone">
              </div>
            </div>

          </div>

          <div class="col-6">


            <div class="form-group row no-gutters">
              <label for="h4" class="col-sm-4 col-form-label">Lead source </label>
              <div class="col-sm-8">
                <select class="form-control border" id="h14" [(ngModel)]="modelContact.id_lead_source"
                  name="id_lead_source">
                  <option value="0"> - Select - </option>
                  <option [ngValue]="x.id" *ngFor="let x of selected.lead_source">{{x.name}}</option>
                </select>
              </div>
            </div>

            <div class="form-group row no-gutters">
              <label for="h4" class="col-sm-4 col-form-label"> Own by </label>
              <div class="col-sm-8">
                <select class="form-control border" [(ngModel)]="modelContact.id_user" name="id_user" #id_user="ngModel"
                  required>

                  <option [ngValue]="x.id" *ngFor="let x of selected.user">{{x.name}}</option>
                </select>

                <small [hidden]="id_user.valid || id_user.pristine" class="text-danger"> Contact owner is
                  required</small>
              </div>
            </div>

            <div class="form-group row no-gutters ">
              <label for="h4" class="col-sm-4 col-form-label"> Company </label>
              <div class="col-sm-8 ">
                <input type="text" class="form-control border" id="h14" readonly value="{{items.name}}">

              </div>
            </div>
          </div>


        </div>
        <div class="border p-1 bg-gray">
          debuging only
          <code>{{diagnosticContact}}</code>
        </div>


      </form>

    </div>
    <div class="modal-footer">
      <button type="button" class="btn btn-outline-dark" (click)="modal.close('Save click')">Cancel</button>
      <button type="submit" class="btn btn-primary m-1" (click)="onSubmitContact();modal.close('Save click');"
        [disabled]="!myForm.form.valid">Save</button>
    </div>
  </ng-template>


  <ng-template #branch let-modal>
    <div class="modal-header">
      <strong class="modal-title" id="modal-basic-title">New Branch</strong>
      <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body bg-light">

      <form (ngSubmit)="onSubmitBranch()" #myFormBranch="ngForm">
        <div class="row">
          <div class="col-6">
            <div class="form-group row no-gutters">
              <label for="h41" class="col-sm-4 col-form-label"> Branch Name</label>
              <div class="col-sm-8">
                <input type="text" class="form-control border" id="h41" required [(ngModel)]="modelBranch.branchName"
                  name="branchName" #branchName="ngModel">

                <small [hidden]="branchName.valid || branchName.pristine" class="text-danger"> Branch name is
                  required</small>
              </div>
            </div>
            <div class="form-group row no-gutters">
              <label for="h434" class="col-sm-4 col-form-label">Branch Code</label>
              <div class="col-sm-8">
                <input type="text" class="form-control border" id="h434" [(ngModel)]="modelBranch.code" name="code">
              </div>
            </div>


            <div class="form-group row no-gutters">
              <label for="h42" class="col-sm-4 col-form-label">Phone</label>
              <div class="col-sm-8">
                <input type="text" class="form-control border" id="h42" [(ngModel)]="modelBranch.phone" name="phone">
              </div>
            </div>

            <div class="form-group row no-gutters">
              <label for="h43" class="col-sm-4 col-form-label">email</label>
              <div class="col-sm-8">
                <input type="text" class="form-control border" id="h43" [(ngModel)]="modelBranch.email" name="email">
              </div>
            </div>

          </div>

          <div class="col-6">
            <div class="form-group row no-gutters">
              <label for="h45" class="col-sm-4 col-form-label">Street</label>
              <div class="col-sm-8">
                <input type="text" class="form-control border" id="h45" [(ngModel)]="modelBranch.address_street"
                  name="address_street">
              </div>
            </div>

            <div class="form-group row no-gutters">
              <label for="h46" class="col-sm-4 col-form-label">City</label>
              <div class="col-sm-8">
                <input type="text" class="form-control border" id="h46" [(ngModel)]="modelBranch.address_city"
                  name="address_city">
              </div>
            </div>

            <div class="form-group row no-gutters">
              <label for="h47" class="col-sm-4 col-form-label">State</label>
              <div class="col-sm-8">
                <input type="text" class="form-control border" id="h47" [(ngModel)]="modelBranch.address_statestate"
                  name="address_state">
              </div>
            </div>

            <div class="form-group row no-gutters">
              <label for="h48" class="col-sm-4 col-form-label">Postal Code</label>
              <div class="col-sm-8">
                <input type="text" class="form-control border" id="h48" [(ngModel)]="modelBranch.address_code"
                  name="address_code">
              </div>
            </div>

          </div>


        </div>
        <div class="border p-1 bg-gray">
          debuging only
          <code>{{diagnosticBranch}}</code>
        </div>


      </form>

    </div>
    <div class="modal-footer">
      <button type="button" class="btn btn-outline-dark" (click)="modal.close('Save click')">Cancel</button>
      <button type="submit" class="btn btn-primary m-1" (click)="onSubmitBranch();modal.dismiss('Cross click')"
        [disabled]="!myFormBranch.form.valid">Save</button>
    </div>
  </ng-template>


  <ng-template #opportunity let-modal>
    <div class="modal-header">
      <strong class="modal-title" id="modal-basic-title">New Opportunity</strong>
      <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body bg-light">

      <div class="form-group row no-gutters">
        <label for="h21" class="col-sm-3 col-form-label"> Name </label>
        <div class="col-sm-8">
          <select class="form-control border">
            <option>Miss Kazaya</option>
          </select>
        </div>
      </div>

      <div class="form-group row no-gutters">
        <label for="h21" class="col-sm-3 col-form-label"> Company </label>
        <div class="col-sm-8">
          <input type="text" class="form-control border" readonly id="h21" value="PT Sugino Mando">
        </div>
      </div>

      <div class="form-group row no-gutters">
        <label for="h21" class="col-sm-3 col-form-label"> Opportunity's Name </label>
        <div class="col-sm-8">
          <input type="text" class="form-control border" maxlength="250" id="h21">
        </div>
      </div>

      <div class="form-group row no-gutters">
        <label for="h21" class="col-sm-3 col-form-label"> Start Date </label>
        <div class="col-sm-2">
          <input type="text" id="dateOfBirth" class="form-control border" placeholder="2019-07-01" readonly
            (click)="dp.toggle()" name="dp" ngbDatepicker #dp="ngbDatepicker">

        </div>

      </div>


    </div>
    <div class="modal-footer">

      <button type="button" class="btn btn-outline-dark" (click)="modal.close('Save click')">Cancel</button>
      <button type="button" class="btn btn-primary" (click)="modal.close('Save click')">Save & Next</button>

    </div>
  </ng-template>